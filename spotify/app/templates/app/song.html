{% extends 'app/base.html' %} 
{% load static %}

{% block content %}
<section class="AddSongAndArtist">

  <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" id="modelbutton">
  Launch demo modal
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      
        <form action="" id="artistform" data-url = "{% url 'createartist' %}">
        <div class="modal-body">

            <div class="form-outline mb-4">
                <label class="form-label" for="name_id">name</label>
                <input type="text" id="name_id" required name="name">
           </div>


            <div class="form-outline mb-4">
                <label class="form-label" for="dateofbirth_id">Date of birth</label>
                <input type="date" id="dateofbirth_id" name="dateofbirth">  
           </div>


           <div class="form-outline mb-4">
                <label class="form-label" for="bio_id">title</label>
                <textarea id="bio_id" name="bio"  rows="4" cols="50"></textarea>
           </div>
           </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

                <input id = "savebutton" type="submit" class="btn btn-secondary" value="Save">
            </div>

        </form>
      
    </div>
  </div>
</div>






  <div class="container">
    <form action="" method="POST" id="songform" enctype='multipart/form-data' data-url="{% url 'createsong' %}">
      {% csrf_token %}
      
        <div class="form-outline mb-4">
            {{form.artists}}
            <label class="form-label" for="formartist">artist</label>
        </div>
        <input type="button" value="add" onclick="$('.overlay').show();">
        <button onclick="$('.overlay').show();">hi</button>
        <!-- Password input -->
        <div class="form-outline mb-4">
            {{form.title}}
            <label class="form-label" for="formtitle">title</label>
        </div>

        
        <!-- 2 column grid layout for inline styling -->
        
        <div class="form-outline mb-4">
            {{form.date}}
            <label class="form-label" for="formdate">date</label>
        </div>
            
        <div class="form-outline mb-4">
            {{form.image}}
            <label class="form-label" for="formimage">image</label>
        </div>


  <!-- Submit button -->
  <button type="button" class="btn btn-primary">Sign in</button>
  <input class="btn btn-primary" type="submit" value="Save" />
  </div>

    </form>
  
</section>
{% endblock %}
 {% block scripts %}
    

    <script>
        function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== "") {
    const cookies = document.cookie.split(";");
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      // Does this cookie string begin with the name we want?
      if (cookie.substring(0, name.length + 1) === name + "=") {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
$(document).ready(function () {
  $("#songform").submit(function (e) {
    e.preventDefault();
    var formData = new FormData(this);
    var url = $(this).data('url')
    $.ajax({
      url: url,
      type: "POST",
      data: formData,

      success: function (data) {
        console.log("success"); // ... do something with the data...
      },
      cache: false,
      contentType: false,
      processData: false,
    });
  });


  
     $("#modelbutton").click(function () {
            $("#exampleModal").modal("show");
     });

     $("#artistform").submit(function (e) {
       e.preventDefault();
       e.stopImmediatePropagation();
       var formdata = $("#artistform").serializeArray();
       formdata.push({
         name: "csrfmiddlewaretoken",
         value: getCookie("csrftoken"),
       });
       var url = $(this).data('url')
       $.ajax({
         url: url,
         type: "post",
         data: formdata,
         success: function (response) {
            $("#exampleModal").modal("hide");
           console.log(response["id"]);
           $("#artist-field-id").prepend(
            `<option value="`+ response["id"]+`">`+ response['name'] +`</option>`
           )
            $("#artist-field-id").find('option[value='+response["id"]+']').prop("selected", true);

         },
       });
     });
   
});

    </script>

{% endblock %}
